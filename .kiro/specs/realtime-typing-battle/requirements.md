# Requirements Document

## Project Description (Input)
ターミナルから起動するオフラインタイピングバトルゲーム。プレイヤーはタイピングで敵と戦い、倒した敵から報酬（コア、モジュール）を得て、エージェントを合成・強化していく。TUI（Text User Interface）アプリケーションとして実装される。

### ゲームループの概要
- **ホーム画面（ハブ）**: エージェント管理、バトル選択、図鑑、統計/実績の4機能
- **バトル選択**: レベル番号を入力し、そのレベルの敵と即座に戦闘
- **バトル構造**: 1バトル = 1敵、完全リアルタイム（敵は常時攻撃）
- **勝利条件**: 敵のHPを0にする
- **敗北条件**: プレイヤーのHPが0になる
- **成長ループ**: 敵撃破 → コア/モジュールドロップ → エージェント合成 → 次のレベルに挑戦

### エージェントシステムの詳細仕様
- **プレイヤー**: HP（敵の攻撃対象）、バフ・デバフ（一時的なステータス効果）
- **エージェント**: 最大3体装備、全て同時に稼働、HP無し（破壊不能）、成長なし
- **構成**: 1エージェント = 1コア + 4モジュール

**コア**:
- 敵を倒すとドロップで獲得
- レベルあり（ドロップ時に決定、成長/アップグレード不可）
- レベル範囲: 敵レベル ± 一定範囲内でランダム
- 特性（物理型、魔法型、回復型、防御型など、3〜5種類、拡張可能設計）
- ステータス（STR、WIL、SPD、LUK）はレベルと特性の偏りで決定
- 固有パッシブスキル（特性ごとに異なる）

**モジュール（スキル）**:
- 敵を倒すとドロップで獲得
- レベルなし（同じタイプのモジュールは全て同じ威力）
- タイプのみ（ファイアボール、ヒール、バフなど、5〜10種類、拡張可能設計）
- 効果計算はコアのステータスに影響される
- 装備数：エージェント1体あたり4個

**エージェント**:
- 合成: 1コア + 4モジュール
- エージェントの「レベル」= コアのレベル
- エージェント自体の成長/レベリングなし

**プレイヤーHP計算**:
- HP = 装備中エージェントのコアレベル平均 × HP係数
- エージェント変更時に再計算
- バトル開始時に全回復

## イントロダクション
本仕様は、ターミナル上で動作するシングルプレイヤー向けリアルタイムタイピングバトルゲームを定義します。プレイヤーはホーム画面を起点に、レベル番号を指定してバトルに挑み、タイピングスキルを駆使して最大3体のエージェント（各エージェントは1コア+4モジュールで構成）を同時操作し、敵と戦います。敵を倒すことでコア（レベル固定）とモジュール（レベルなし）を獲得し、新しいエージェントを合成していく育成要素が中核となります。長期目標は最高レベル（例：レベル100）の敵を倒すことです。ネットワーク接続は不要で、TUI（Text User Interface）により直感的な操作感を提供します。

## Requirements

### Requirement 1: ゲーム起動とTUI環境
**Objective:** プレイヤーとして、ターミナルから簡単にゲームを起動し、快適なTUI環境でプレイしたい。これにより、どの環境でも手軽にゲームを楽しめる。

#### Acceptance Criteria
1. When プレイヤーがターミナルでゲーム実行コマンドを入力した場合, the ゲームシステムはTUIインターフェースを起動する
2. The ゲームシステムはターミナルのサイズを検出し、最小120x40文字の表示領域を確保する
3. If ターミナルサイズが最小要件を満たさない場合, then the ゲームシステムは警告メッセージを表示し推奨サイズを通知する
4. The ゲームシステムはUTF-8エンコーディングで日本語テキストを正しく表示する
5. When ゲームが起動した場合, the ゲームシステムはホーム画面を表示する
6. The ゲームシステムはキーボード入力のみで全ての操作を可能にする
7. When プレイヤーが終了操作を実行した場合, the ゲームシステムはターミナルの状態を元に戻し正常終了する

### Requirement 2: ホーム画面（ハブ）システム
**Objective:** プレイヤーとして、ホーム画面から全てのゲーム機能にアクセスしたい。これにより、シンプルで分かりやすいナビゲーションが可能になる。

#### Acceptance Criteria
1. When ゲームが起動した場合, the ゲームシステムはホーム画面を表示する
2. The ゲームシステムはホーム画面に4つの主要機能（エージェント管理、バトル選択、図鑑、統計/実績）を表示する
3. When プレイヤーがエージェント管理を選択した場合, the ゲームシステムはエージェント管理画面に遷移する
4. When プレイヤーがバトル選択を選択した場合, the ゲームシステムはバトル選択画面に遷移する
5. When プレイヤーが図鑑を選択した場合, the ゲームシステムは図鑑画面に遷移する
6. When プレイヤーが統計/実績を選択した場合, the ゲームシステムは統計/実績画面に遷移する
7. The ゲームシステムは矢印キーまたはhjkl（Vim形式）でメニュー項目を選択可能にする
8. When プレイヤーがEnterキーを押した場合, the ゲームシステムは選択中のメニュー項目を実行する
9. When プレイヤーが各機能画面からホームに戻る操作を実行した場合, the ゲームシステムはホーム画面に遷移する
10. The ゲームシステムはホーム画面に現在の進行状況（到達最高レベル、装備中エージェント）を表示する

### Requirement 3: バトル選択システム
**Objective:** プレイヤーとして、挑戦するレベルを自由に選択してバトルを開始したい。これにより、自分のペースでゲームを進められる。

#### Acceptance Criteria
1. When プレイヤーがバトル選択画面を開いた場合, the ゲームシステムはレベル番号入力欄を表示する
2. The ゲームシステムは現在の到達最高レベルと挑戦可能な最大レベル（到達最高レベル + 1）を表示する
3. When プレイヤーがレベル番号を入力した場合, the ゲームシステムは入力値を検証する
4. If 入力されたレベルが1未満の場合, then the ゲームシステムはエラーメッセージを表示し再入力を促す
5. If 入力されたレベルが挑戦可能な最大レベルを超える場合, then the ゲームシステムはエラーメッセージを表示し挑戦可能な最大レベルを通知する
6. When 有効なレベル番号が入力された場合, the ゲームシステムは確認画面（レベル番号、予想敵情報）を表示する
7. When プレイヤーがバトル開始を確定した場合, the ゲームシステムは指定レベルの敵を生成しバトル画面に遷移する
8. If プレイヤーが1体もエージェントを装備していない場合, then the ゲームシステムはバトル開始を拒否しエージェント装備を促すメッセージを表示する
9. When バトルに勝利した場合, the ゲームシステムは到達最高レベルを更新する（勝利レベルが現在の最高レベルより高い場合）
10. The ゲームシステムは過去にクリアしたレベルへの再挑戦を許可する

### Requirement 4: プレイヤー管理
**Objective:** プレイヤーとして、自分のHP、バフ・デバフ状態を確認したい。これにより、戦況を把握し戦略的にゲームを進められる。

#### Acceptance Criteria
1. The ゲームシステムはプレイヤーのHPを装備中エージェントのコアレベル平均 × HP係数で計算する
2. When エージェントの装備・装備解除が実行された場合, the ゲームシステムはプレイヤーの最大HPを再計算し更新する
3. When バトル開始時, the ゲームシステムはプレイヤーのHPを最大値まで全回復する
4. The ゲームシステムはバトル画面にプレイヤーの現在HP、最大HPを常時表示する
5. The ゲームシステムはバフ・デバフの効果名、効果時間、効果量を表示する
6. When バフ・デバフの効果時間が経過した場合, the ゲームシステムはその効果を削除する
7. The ゲームシステムはプレイヤーのHPを次のバトルに持ち越さない（各バトルで全回復）

### Requirement 5: コア管理システム
**Objective:** プレイヤーとして、獲得したコアを管理し、それぞれの特性と装備可能なモジュールを確認したい。これにより、エージェント合成時に最適なコアを選択できる。

#### Acceptance Criteria

##### 基本管理機能
1. The ゲームシステムはエージェント管理画面内にコア一覧機能を提供する
2. When プレイヤーがコア一覧を開いた場合, the ゲームシステムは所持している全コアをリスト表示する
3. The ゲームシステムは各コアの名前、レベル、特性、現在のステータス（STR、WIL、SPD、LUK）を表示する
4. The ゲームシステムは各特性に固有のパッシブスキル名と効果説明を表示する
5. When プレイヤーがコアを選択した場合, the ゲームシステムは詳細情報（レベル、特性、ステータス配分、パッシブスキル効果、装備可能モジュール一覧）を表示する
6. The ゲームシステムはコアのレベル成長/アップグレード機能を提供しない（レベルはドロップ時に固定）
7. The ゲームシステムは不要なコアを破棄する機能を提供する
8. The ゲームシステムはコアを特性、レベルでフィルタリング・ソート表示する機能を提供する

##### コア特性とモジュール装備制限（タグシステム）
9. The ゲームシステムは各コア特性に「装備可能なモジュールカテゴリとレベル上限」を定義する
10. The ゲームシステムはコア特性ごとに許可するモジュールタグ（カテゴリタグ + レベルタグ）のリストを持つ
11. When コアの装備可能モジュールを判定する場合, the ゲームシステムはモジュールのタグがコアの許可タグリストに含まれるかを確認する
12. If モジュールのタグがコアの許可タグに含まれない場合, then the ゲームシステムはそのモジュールをコアに装備不可とする

##### 初期コア特性ラインナップ
13. The ゲームシステムは初期特性として以下の4種類を用意する（拡張可能な設計）
14. The ゲームシステムは「攻撃バランス」特性を用意する（物理攻撃Lv低 + 魔法攻撃Lv低を装備可能）
15. The ゲームシステムは「パラディン」特性を用意する（バフLv中 + 回復Lv低を装備可能）
16. The ゲームシステムは「オールラウンダー」特性を用意する（全カテゴリLv低を装備可能）
17. The ゲームシステムは「ヒーラー」特性を用意する（回復Lv中〜高を装備可能）
18. The ゲームシステムは初期段階では高レベルモジュールを装備可能な特化コアを用意しない（ゲーム進行で追加想定）
19. The ゲームシステムはコア特性を外部データファイルで定義し拡張可能にする

### Requirement 6: モジュール管理システム
**Objective:** プレイヤーとして、獲得したモジュール（スキル）を管理し、効果とタグを確認したい。これにより、コアの特性に合った最適なモジュール構成を選択できる。

#### Acceptance Criteria

##### 基本管理機能
1. The ゲームシステムはエージェント管理画面内にモジュール一覧機能を提供する
2. When プレイヤーがモジュール一覧を開いた場合, the ゲームシステムは所持している全モジュールをリスト表示する
3. The ゲームシステムは各モジュールの名前、カテゴリ、レベル、タグを表示する
4. The ゲームシステムは各モジュールの効果説明と参照するエージェントステータス（STR、WIL、SPD、LUKのいずれか）を表示する
5. When プレイヤーがモジュールを選択した場合, the ゲームシステムは詳細情報（カテゴリ、レベル、タグ、効果説明、ステータス参照）を表示する
6. The ゲームシステムは不要なモジュールを破棄する機能を提供する
7. The ゲームシステムはモジュールをカテゴリ、レベルでフィルタリング・ソート表示する機能を提供する

##### モジュールタグシステム
8. The ゲームシステムは各モジュールにカテゴリタグを付与する（物理攻撃、魔法攻撃、回復、バフ、デバフ）
9. The ゲームシステムは各モジュールにレベルタグを付与する（Lv1、Lv2、Lv3など）
10. The ゲームシステムはモジュールの種類ごとにレベルを固定する（「物理攻撃Lv1」「物理攻撃Lv2」は別種類のモジュールとして存在）
11. The ゲームシステムは同じ種類のモジュールは全て同じ効果を持つ（同名・同レベルなら同威力）

##### モジュールカテゴリ定義
12. The ゲームシステムは「物理攻撃」カテゴリを定義する（STR参照、敵に物理ダメージを与える）
13. The ゲームシステムは「魔法攻撃」カテゴリを定義する（WIL参照、敵に魔法ダメージを与える）
14. The ゲームシステムは「回復」カテゴリを定義する（WIL参照、プレイヤーHPを回復する）
15. The ゲームシステムは「バフ」カテゴリを定義する（プレイヤーに有利な効果を付与する）
16. The ゲームシステムは「デバフ」カテゴリを定義する（敵に不利な効果を付与する）

##### 初期モジュールラインナップ
17. The ゲームシステムは各カテゴリにLv1〜Lv3程度のモジュールを用意する（初期実装、拡張可能）
18. The ゲームシステムはモジュール定義を外部データファイルで管理し拡張可能にする

### Requirement 7: エージェント合成システム
**Objective:** プレイヤーとして、コア1個とコアの特性に適合するモジュール4個を組み合わせて新しいエージェントを作成したい。これにより、戦略に応じた多様なエージェント構成を実現できる。

#### Acceptance Criteria

##### 基本合成機能
1. The ゲームシステムはエージェント管理画面内にエージェント合成機能を提供する
2. When プレイヤーが合成画面を開いた場合, the ゲームシステムはコア選択欄とモジュール選択欄（4スロット）を表示する
3. The ゲームシステムはコア一覧から1個のコアを選択可能にする
4. When コアが選択された場合, the ゲームシステムはそのコア特性に装備可能なモジュールのみをモジュール一覧に表示する
5. The ゲームシステムはコアに装備不可能なモジュールをグレーアウト表示または非表示にする
6. The ゲームシステムは装備可能なモジュール一覧から4個のモジュールを選択可能にする
7. When コアとモジュール4個が選択された場合, the ゲームシステムは合成可能状態として確定ボタンを有効化する
8. When 合成確定ボタンが押された場合, the ゲームシステムは選択されたコアとモジュールを消費し新しいエージェントを作成する
9. The ゲームシステムは合成されたエージェントの情報（エージェントレベル = コアレベル、ステータス、装備モジュール）を表示する

##### 合成制限とバリデーション
10. If モジュールのタグがコアの許可タグに含まれない場合, then the ゲームシステムはそのモジュールの選択を拒否する
11. If 選択されたコアまたはモジュールが不足している場合, then the ゲームシステムは合成を拒否し不足している要素を通知する
12. If エージェント保有数が上限に達している場合, then the ゲームシステムは合成を拒否し保有上限を通知する
13. The ゲームシステムは合成プレビューで最終的なエージェントのステータスと能力を確定前に表示する

### Requirement 8: エージェント装備・管理システム
**Objective:** プレイヤーとして、最大3体のエージェントを装備し、装備中のエージェントを管理したい。これにより、バトルで使用するエージェント編成を柔軟に変更できる。

#### Acceptance Criteria
1. The ゲームシステムはエージェント管理画面内にエージェント装備機能を提供する
2. When プレイヤーが装備画面を開いた場合, the ゲームシステムは3つの装備スロットと所持エージェント一覧を表示する
3. The ゲームシステムは各装備スロットに現在装備中のエージェント情報（名前、コア特性、エージェントレベル = コアレベル、ステータス、モジュール構成）を表示する
4. When プレイヤーが空きスロットを選択した場合, the ゲームシステムは所持エージェント一覧から装備可能なエージェントを選択可能にする
5. When エージェントが装備された場合, the ゲームシステムはそのエージェントを選択されたスロットに配置する
6. When エージェントの装備・装備解除が実行された場合, the ゲームシステムはプレイヤーの最大HPを再計算し更新する
7. When 装備中のエージェントを選択した場合, the ゲームシステムは装備解除オプションを提供する
8. The ゲームシステムは装備中エージェントの詳細情報（ステータス、モジュール効果、パッシブスキル）を表示する
9. The ゲームシステムは所持エージェントを破棄する機能を提供する
10. If 破棄しようとしているエージェントが装備中の場合, then the ゲームシステムは警告メッセージを表示し確認を求める

### Requirement 9: リアルタイムバトルシステム
**Objective:** プレイヤーとして、装備した3体のエージェントを同時に操作し、完全リアルタイムで敵と戦いたい。これにより、タイピングスキルと戦略が融合した独自のゲーム体験が得られる。

#### Acceptance Criteria
1. When プレイヤーがバトル開始を確定した場合, the ゲームシステムは指定レベルの敵を生成しバトル画面に遷移する
2. The ゲームシステムはバトル画面に敵の名前、HP、レベルを表示する
3. The ゲームシステムはバトル画面にプレイヤーのHP、現在のバフ・デバフを表示する
4. The ゲームシステムはバトル画面に装備中の全エージェント（最大3体）のモジュール（各4個、合計最大12個）を一覧表示する
5. The ゲームシステムは各モジュールの名前、タイプ、クールダウン状態を表示する
6. When プレイヤーがモジュールを選択した場合, the ゲームシステムはタイピングチャレンジテキストを表示する
7. The ゲームシステムはプレイヤーのキー入力を受け付け、チャレンジテキストとの照合を行う
8. When プレイヤーが正しい文字を入力した場合, the ゲームシステムは入力進捗を更新し次の文字にカーソルを進める
9. If プレイヤーが誤った文字を入力した場合, then the ゲームシステムは誤字として視覚的にフィードバックする
10. When プレイヤーがチャレンジテキストを完了した場合, the ゲームシステムはタイピング速度と正確性を計算する
11. When チャレンジが完了した場合, the ゲームシステムは選択されたモジュールの効果を即座に実行する
12. The ゲームシステムはモジュール使用後にクールダウン時間を設定し、クールダウン中は該当モジュールを選択不可にする
13. While バトルが進行中の間, the ゲームシステムは敵の自動攻撃を固定間隔で継続的に実行しプレイヤーのHPを減少させる
14. While プレイヤーがモジュール選択中の間, the ゲームシステムは敵の攻撃を停止せず継続する
15. While プレイヤーがタイピング中の間, the ゲームシステムは敵の攻撃を停止せず継続する
16. When プレイヤーのHPが0になった場合, the ゲームシステムはバトル敗北として処理する
17. When 敵のHPが0になった場合, the ゲームシステムはバトル勝利として処理する

### Requirement 10: モジュール効果計算システム
**Objective:** システムとして、各モジュールがコアのステータスとタイピングパフォーマンスを反映した効果を計算したい。これにより、柔軟で戦略的なスキルシステムを実現できる。

#### Acceptance Criteria
1. The ゲームシステムは各モジュールに参照ステータス（STR、WIL、SPD、LUKのいずれか）を定義する
2. When 攻撃系モジュールが実行された場合, the ゲームシステムは（モジュール基礎効果値 × コアの参照ステータス値 × タイピング速度係数 × 正確性係数）でダメージを算出する
3. When 回復系モジュールが実行された場合, the ゲームシステムは（モジュール基礎効果値 × コアの参照ステータス値 × タイピング速度係数 × 正確性係数）で回復量を算出する
4. When バフ系モジュールが実行された場合, the ゲームシステムはプレイヤーに一時的なステータス上昇効果を付与する
5. When デバフ系モジュールが実行された場合, the ゲームシステムは敵に一時的なステータス低下効果を付与する
6. The ゲームシステムはタイピング速度係数を（基準時間 / 実際の完了時間）で計算する
7. The ゲームシステムは正確性係数を（正しい入力文字数 / 総入力文字数）で計算する
8. If タイピング速度係数が2.0を超える場合, then the ゲームシステムは係数を2.0に制限する
9. If 正確性係数が50%未満の場合, then the ゲームシステムは効果量を半減させる
10. The ゲームシステムは計算された効果量とタイピングパフォーマンスをバトル画面に表示する

### Requirement 11: 敵攻撃システム
**Objective:** システムとして、敵がプレイヤーHPを自動的に継続攻撃し、敵の種類に応じた多様な攻撃パターンで適切な緊張感を生み出したい。これにより、プレイヤーに戦略的な対応を求める。

#### Acceptance Criteria

##### 基本攻撃システム
1. When バトルが開始された場合, the ゲームシステムは敵の自動攻撃タイマーを即座に開始する
2. While バトルが進行中の間, the ゲームシステムは敵の種類に応じた間隔で攻撃を自動実行する
3. The ゲームシステムは敵の攻撃タイミングをプレイヤーの行動状態（モジュール選択中、タイピング中、待機中）に関係なく一定間隔で維持する
4. When 敵の攻撃が実行された場合, the ゲームシステムは（敵の攻撃力 - プレイヤーの防御バフ）でダメージを計算する
5. When ダメージが計算された場合, the ゲームシステムはプレイヤーの現在HPを即座に減少させる
6. The ゲームシステムはエージェントに対する攻撃を実行しない（エージェントはHPを持たず破壊不能）

##### 攻撃予告と表示
7. The ゲームシステムは敵の次回攻撃までの残り時間をリアルタイムでカウントダウン表示する
8. The ゲームシステムは次回攻撃の属性(物理or魔法)と予測ダメージ量を表示する
9. The ゲームシステムは敵の攻撃ダメージ量を画面に表示する
10. The ゲームシステムは攻撃実行時に視覚的フィードバック（画面エフェクト、ダメージ数値）を提供する

##### 敵の種類と攻撃パターン
11. The ゲームシステムは敵の種類ごとに異なる攻撃パターン（行動セット）を定義する
12. The ゲームシステムは敵の種類ごとに基本攻撃間隔を設定する（スピード型：短い間隔、パワー型：長い間隔など）
13. The ゲームシステムは初期の敵タイプとしてバランス型（標準的な攻撃力と間隔）を用意する
14. The ゲームシステムは敵タイプを拡張可能な設計にする（外部データファイルで定義）

##### HPフェーズ変化システム
15. When 敵のHPが50%以下になった場合, the ゲームシステムは敵を強化フェーズに移行させる
16. When 敵が強化フェーズに移行した場合, the ゲームシステムは敵の特殊攻撃を解禁する
17. When 敵が強化フェーズに移行した場合, the ゲームシステムは視覚的変化（色変更、エフェクト）で表示する

##### 敵の特殊行動（自己バフ）
18. The ゲームシステムは敵が自己バフ行動（攻撃力アップ）を使用できるようにする
19. The ゲームシステムは敵が自己バフ行動（物理ダメージ軽減）を使用できるようにする
20. The ゲームシステムは敵が自己バフ行動（魔法ダメージ軽減）を使用できるようにする
21. When 敵がバフ行動を使用した場合, the ゲームシステムはバフアイコンと効果時間を表示する

##### 敵の特殊行動（プレイヤーへのデバフ）
22. The ゲームシステムは敵がプレイヤーにデバフ（タイピング制限時間短縮）を付与できるようにする
23. The ゲームシステムは敵がプレイヤーにデバフ（チャレンジテキスト文字シャッフル）を付与できるようにする
24. The ゲームシステムは敵がプレイヤーにデバフ（チャレンジ難易度上昇：より長いテキスト）を付与できるようにする
25. The ゲームシステムは敵がプレイヤーにデバフ（モジュールクールダウン延長）を付与できるようにする
26. When プレイヤーにデバフが付与された場合, the ゲームシステムはデバフアイコンと残り時間を表示する
27. When デバフの効果時間が終了した場合, the ゲームシステムはデバフを解除し通常状態に戻す

##### バフ・デバフの相互作用
28. If プレイヤーに防御バフが適用されている場合, then the ゲームシステムはバフ効果量を攻撃ダメージから減算する
29. If 敵に攻撃力デバフが適用されている場合, then the ゲームシステムはデバフ効果量を敵の攻撃力から減算する
30. If 敵にダメージ軽減バフが適用されている場合, then the ゲームシステムはプレイヤーの攻撃ダメージを軽減する

### Requirement 12: ドロップ・報酬システム
**Objective:** プレイヤーとして、敵を倒すことでコアとモジュールを獲得し、成長を実感したい。これにより、継続的なプレイ動機と育成の楽しさが生まれる。

#### Acceptance Criteria

##### 基本報酬システム
1. When プレイヤーがバトルに勝利した場合, the ゲームシステムは報酬画面を表示する
2. The ゲームシステムは報酬画面にバトル統計（WPM、正確性、クリアタイム）を表示する
3. When 報酬確認が完了した場合, the ゲームシステムはホーム画面に遷移する
4. If バトルに敗北した場合, then the ゲームシステムは報酬を付与せずホーム画面に直接遷移する

##### コアドロップシステム
5. When バトルに勝利した場合, the ゲームシステムはコアドロップ判定を実行する
6. When コアがドロップした場合, the ゲームシステムはコアのレベルを敵レベル ± 一定範囲内でランダムに決定する
7. When コアがドロップした場合, the ゲームシステムはコアの名前、特性、レベル、ステータスを表示しインベントリに追加する
8. The ゲームシステムは各コア特性に「ドロップ最低敵レベル」を設定する
9. If 敵のレベルがコア特性のドロップ最低敵レベル未満の場合, then the ゲームシステムはそのコア特性をドロップ候補から除外する
10. The ゲームシステムは初期コア特性のドロップ最低敵レベルを設定する（攻撃バランス:Lv1、パラディン:Lv5、オールラウンダー:Lv1、ヒーラー:Lv3など）

##### モジュールドロップシステム
11. When バトルに勝利した場合, the ゲームシステムはモジュールドロップ判定を実行する
12. When モジュールがドロップした場合, the ゲームシステムは各モジュールの名前、カテゴリ、レベルを表示しインベントリに追加する
13. The ゲームシステムは各モジュール（カテゴリ×レベルの組み合わせ）に「ドロップ最低敵レベル」を設定する
14. If 敵のレベルがモジュールのドロップ最低敵レベル未満の場合, then the ゲームシステムはそのモジュールをドロップ候補から除外する
15. The ゲームシステムはモジュールレベルに応じたドロップ最低敵レベルを設定する（例：物理攻撃Lv1は敵Lv1以上、物理攻撃Lv2は敵Lv10以上、物理攻撃Lv3は敵Lv20以上など）
16. The ゲームシステムは高レベルモジュールほど高レベルの敵からのみドロップするよう段階的に設定する

##### インベントリ管理
17. If インベントリが満杯の状態でアイテムがドロップした場合, then the ゲームシステムは警告を表示し不要なアイテムの破棄を促す
18. The ゲームシステムはドロップしたがインベントリに入らなかったアイテムを一時保管し、後で受け取る機会を提供する

### Requirement 13: 敵生成システム
**Objective:** システムとして、指定されたレベルに応じた敵を生成したい。これにより、プログレッシブな難易度と多様なバトル体験を提供できる。

#### Acceptance Criteria
1. When プレイヤーがレベルを指定してバトル開始した場合, the ゲームシステムは指定レベルの敵を生成する
2. The ゲームシステムは敵のHP、攻撃力、攻撃間隔をレベルに応じて計算する
3. The ゲームシステムは各敵に固有の名前、外観（ASCIIアート）を設定する
4. The ゲームシステムは複数種類の敵キャラクター（最低10種類）を用意する
5. The ゲームシステムは同じレベルでも複数の敵バリエーションからランダムに選択する
6. The ゲームシステムは高レベル敵ほど高いステータスと短い攻撃間隔を設定する
7. The ゲームシステムはレベル上限（例：レベル100）を設定する
8. When 最高レベルの敵に勝利した場合, the ゲームシステムはゲームクリア演出を表示する

### Requirement 14: 図鑑システム
**Objective:** プレイヤーとして、獲得したコア・モジュール・遭遇した敵の情報を閲覧したい。これにより、コレクション要素とゲームの深い理解が得られる。

#### Acceptance Criteria
1. The ゲームシステムは図鑑画面に3つのカテゴリ（コア図鑑、モジュール図鑑、敵図鑑）を表示する
2. When プレイヤーがコア図鑑を開いた場合, the ゲームシステムは全特性の一覧と獲得状況を表示する
3. The ゲームシステムは獲得済みコア特性の詳細情報（ステータス傾向、パッシブスキル）を表示する
4. The ゲームシステムは未獲得コア特性をシルエットまたは「???」で表示する
5. When プレイヤーがモジュール図鑑を開いた場合, the ゲームシステムは全タイプの一覧と獲得状況を表示する
6. The ゲームシステムは獲得済みモジュールタイプの詳細情報（効果、参照ステータス）を表示する
7. The ゲームシステムは未獲得モジュールタイプをシルエットまたは「???」で表示する
8. When プレイヤーが敵図鑑を開いた場合, the ゲームシステムは遭遇済みの敵一覧を表示する
9. The ゲームシステムは遭遇済み敵の詳細情報（名前、レベル範囲、外観、基本情報）を表示する
10. The ゲームシステムは未遭遇敵をシルエットまたは「???」で表示する
11. The ゲームシステムは図鑑のコンプリート率を表示する

### Requirement 15: 実績システム
**Objective:** プレイヤーとして、タイピングとバトルの実績を確認し達成感を得たい。これにより、長期的なモチベーションとゲームの目標が生まれる。

#### Acceptance Criteria
1. The ゲームシステムは統計/実績画面にタイピング統計と実績一覧を表示する
2. The ゲームシステムはタイピング統計（通算WPM最高記録、平均WPM、100%正確性達成回数、総タイプ文字数）を記録・表示する
3. The ゲームシステムはバトル統計（総バトル数、勝利数、敗北数、到達最高レベル）を記録・表示する
4. The ゲームシステムはタイピング実績（WPMマイルストーン：50, 80, 100, 120 WPM達成など）を用意する
5. The ゲームシステムはタイピング実績（100%正確性でのクリア達成）を用意する
6. The ゲームシステムはバトル実績（敵撃破数マイルストーン：10, 50, 100, 500体など）を用意する
7. The ゲームシステムはバトル実績（レベルマイルストーン：レベル10, 25, 50, 100到達など）を用意する
8. The ゲームシステムはバトル実績（ノーダメージクリア達成）を用意する
9. When 実績が達成された場合, the ゲームシステムは達成通知を表示する
10. The ゲームシステムは達成済み実績と未達成実績を区別して表示する
11. The ゲームシステムは実績のコンプリート率を表示する

### Requirement 16: タイピングチャレンジ生成
**Objective:** システムとして、モジュールごとに適切な難易度のタイピング課題を生成したい。これにより、スキルの強さに応じた挑戦を提供できる。

#### Acceptance Criteria
1. The ゲームシステムは英数字および記号（a-z, A-Z, 0-9, 基本記号）のチャレンジテキストを提供する
2. The ゲームシステムはデフォルトの単語セット（英単語、プログラミング用語など）を内蔵する
3. The ゲームシステムはチャレンジテキストの辞書を外部ファイルから読み込む仕組みを提供する
4. When 外部辞書ファイルが存在する場合, the ゲームシステムはデフォルト辞書と外部辞書を併用または切り替え可能にする
5. The ゲームシステムは各モジュールに固定の難易度（チャレンジテキストの長さ・複雑さ）を設定する
6. When 弱いモジュール（基本攻撃など）の場合, the ゲームシステムは短いテキスト（3〜6文字）を生成する
7. When 中程度のモジュール（中級スキルなど）の場合, the ゲームシステムは中程度のテキスト（7〜11文字）を生成する
8. When 強力なモジュール（上級スキルなど）の場合, the ゲームシステムは長いテキスト（12〜20文字）を生成する
9. The ゲームシステムは同じチャレンジテキストが連続しないようランダム選択する
10. The ゲームシステムは各モジュールにタイピング制限時間を設定する
11. When タイピング制限時間を超過した場合, the ゲームシステムはスキル発動をキャンセルし、ペナルティ（クールダウン開始など）を適用する
12. The ゲームシステムはタイピング中に残り時間をリアルタイムで表示する
13. The ゲームシステムは制限時間をモジュールの難易度に応じて設定する（短いテキストは短い制限時間、長いテキストは長い制限時間）

### Requirement 17: セーブとロード機能
**Objective:** プレイヤーとして、ゲームの進行状況を保存し後で再開したい。これにより、長期的なプレイ継続が可能になる。

#### Acceptance Criteria
1. The ゲームシステムは自動セーブ機能を提供する
2. When バトル終了時, the ゲームシステムは現在の状態を自動的に保存する
3. When プレイヤーが手動セーブを実行した場合, the ゲームシステムは現在の状態をセーブファイルに書き込む
4. The ゲームシステムは到達最高レベル、所持コア・モジュール・エージェント、装備エージェント、統計/実績データを保存する
5. When ゲーム起動時にセーブデータが存在する場合, the ゲームシステムはセーブデータを自動読み込みする
6. If セーブデータの読み込みに失敗した場合, then the ゲームシステムはエラーメッセージを表示し新規ゲームの開始を促す
7. The ゲームシステムはセーブデータを1スロット管理する（シンプルな設計）
8. The プレイヤーはセーブをリセットして最初からやり直せる

### Requirement 18: ビジュアル表現とUI/UX
**Objective:** プレイヤーとして、見やすく分かりやすいUIでゲームをプレイしたい。これにより、ストレスなくゲームに集中できる。

#### Acceptance Criteria
1. The ゲームシステムはボックス描画文字を使用して視覚的な境界線とレイアウトを提供する
2. The ゲームシステムはカラー表示をサポートし、重要な情報を色分けする（HP：緑/黄/赤、ダメージ：赤、回復：緑）
3. If ターミナルがカラー表示に対応していない場合, then the ゲームシステムは記号や文字装飾で代替表示する
4. The ゲームシステムはプレイヤーと敵のHPバーを視覚的に表示する
5. When ダメージが発生した場合, the ゲームシステムはダメージ量をアニメーション効果付きで表示する
6. The ゲームシステムは入力中の文字、完了済み文字、未入力文字を異なる色で表示する
7. The ゲームシステムは重要なメッセージ（レベルクリア、アイテム獲得など）を強調表示する
8. The ゲームシステムは画面のちらつきを最小限に抑える描画更新を行う
9. The ゲームシステムはモジュールのクールダウン状態を視覚的に表示する（プログレスバー、残り秒数）
10. The ゲームシステムはエージェントごとにモジュールをグループ化して表示する

### Requirement 19: エラー処理と安定性
**Objective:** システムとして、予期しないエラーに対処しゲームの安定性を保ちたい。これにより、プレイヤーの進行が失われることを防ぐ。

#### Acceptance Criteria
1. If セーブファイルの書き込みに失敗した場合, then the ゲームシステムはエラーを通知しリトライオプションを提供する
2. If セーブファイルが破損している場合, then the ゲームシステムは警告を表示しバックアップからの復元を試みる
3. When 予期しない例外が発生した場合, the エラーメッセージを表示して終了する
4. The ゲームシステムは不正な入力値を検証しゲームクラッシュを防ぐ
5. When ターミナルのサイズが変更された場合, the ゲームシステムは表示を再調整するか警告を表示する
6. The ゲームシステムはデバッグモードを提供しエラー詳細をログファイルに記録する

### Requirement 20: ゲームバランスと難易度調整
**Objective:** プレイヤーとして、適度な難易度で挑戦しがいのあるゲーム体験をしたい。これにより、長期的に楽しめるゲームになる。

#### Acceptance Criteria
1. The ゲームシステムはプログレッシブレベルアンロック方式を採用する（挑戦可能レベル = 到達最高レベル + 1）
2. The ゲームシステムは敵のステータス（HP、攻撃力、攻撃間隔）をレベルに応じてスケーリングする
3. The ゲームシステムはチャレンジテキストの長さを敵レベルに応じて調整する
4. The ゲームシステムは敵の攻撃間隔を敵のレベルに応じて短縮する（低レベル敵：長い間隔、高レベル敵：短い間隔）
5. The ゲームシステムはコアのドロップレベル範囲を敵レベル基準で設定する
6. The ゲームシステムはエージェントの保有上限（最低20体）を設定する
7. The ゲームシステムはプレイヤーのHP計算式を（装備中エージェントのコアレベル平均 × HP係数）で定義する
8. The ゲームシステムはレベル上限（例：レベル100）を設定し、最終目標を明確にする

### Requirement 21: 拡張性と設定
**Objective:** プレイヤーとして、ゲームの設定をカスタマイズし自分好みのプレイ体験にしたい。これにより、個々のプレイヤーのニーズに対応できる。

#### Acceptance Criteria
1. The ゲームシステムはホーム画面から設定画面へのアクセスを提供する
2. When プレイヤーが設定を開いた場合, the ゲームシステムは変更可能な設定項目（キーバインド設定）を表示する
3. The ゲームシステムは設定変更を即座に適用する
4. When プレイヤーが設定を保存した場合, the ゲームシステムは設定ファイルに書き込む
5. When ゲーム起動時, the ゲームシステムは保存された設定を読み込み適用する
6. The ゲームシステムはチャレンジテキストのデータを外部ファイルから読み込む仕組みを提供する
7. The ゲームシステムはコア、モジュール、敵のデータを外部ファイル（JSON/YAML）で管理可能にする
