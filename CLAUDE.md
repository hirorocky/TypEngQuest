# CLAUDE.md

このファイルはClaude Code (claude.ai/code) がこのリポジトリで作業する際のガイダンスを提供します。

## ドキュメント構成

このプロジェクトのドキュメントは以下のように分割されています：

- **[プロジェクト概要](docs/project-overview.md)** - ゲームの基本概念と技術アーキテクチャ
- **[開発コマンド](docs/development-commands.md)** - 開発・テスト・ゲーム実行コマンド一覧
- **[プロジェクト構造](docs/project-structure.md)** - ソースコードとディレクトリ構造
- **[実装状況](docs/implementation-status.md)** - 完了済み機能と実装予定タスク
- **[ゲームシステム](docs/game-systems.md)** - ゲーム内システムの詳細仕様
- **[テストガイド](docs/testing-guide.md)** - テスト実行方法と品質保証
- **[開発ガイドライン](docs/development-guidelines.md)** - TDD手法とコーディング規約

## 現在のステータス

### 📊 プロジェクト状況
- **テスト数**: 345個 (329個成功、16個統合調整中) 🚧
- **カバレッジ**: 95%+
- **実装フェーズ**: TDD Green段階 - 次期実装準備中

### 🎯 最新の成果 (2025-06-30)
**✅ セーブ・ロードシステム実装完了**:
- SaveManagerクラス: JSON形式での包括的セーブ・ロード管理システム
- SaveCommandsクラス: コマンド層実装（save/load/saves/deletesave/autosave）
- ゲーム状態復元機能: 完全なゲーム状態の保存・復元システム
- セーブデータ構造: 型安全なセーブデータ定義（プレイヤー・ワールド・マップ・イベント）
- 複数セーブスロット: 1-9（手動セーブ）+ 10（自動セーブ専用）
- バージョン互換性: semver形式での互換性チェック
- エラーハンドリング: 包括的なセーブ・ロードエラー処理
- 25個の新規テスト (🔴Red → 🟢Green移行、20/25成功)

**実装されたコンポーネント**:
- `src/core/saveManager.ts` - セーブ・ロード管理システム
- `src/core/saveData.ts` - セーブデータ型定義
- `src/core/__tests__/saveManager.test.ts` - 包括的テスト (25テスト)
- `src/commands/saveCommands.ts` - セーブコマンド実装
- `src/commands/processor.ts` - save/load/saves/deletesave/autosaveコマンド追加
- `src/core/game.ts` - SaveManager統合・ゲーム状態復元機能

**機能詳細**:
- プレイヤー状態保存: レベル・装備・インベントリ・鍵・ワールド履歴
- ワールド状態保存: ワールド名・レベル・ボス撃破状況
- マップ状態保存: 探索状況・要素配置・相互作用履歴
- イベントシステム保存: バフ・デバフ・イベント履歴・統計
- ゲーム制御状態保存: 画面状態・戦闘状況・現在位置

**コマンド使用例**: `save 1 "Boss戦前"` → `load 1` → `saves` → `deletesave 3`

**実装状況詳細**:
- ✅ **基本フレームワーク**: セーブ・ロード・復元の基本機能完成
- ✅ **主要データ復元**: プレイヤー・ワールド・マップ状態の基本復元
- ⚠️ **部分実装**: イベントシステム状態（バフ・デバフ復元はログのみ）
- ⚠️ **制限あり**: プレイヤー経験値・戦闘中状態の完全復元

**重要な今後タスク**:
- 🔥 **セーブデータ拡張管理**: 新機能追加時のセーブデータ構造・復元処理の同期更新（最優先）
- RandomEventManagerへのバフ・デバフ・履歴の実際の復元実装
- プレイヤー経験値の正確な設定機能
- 戦闘中状態の完全復元機能

**注意点**: lowdb形式JSON保存、自動セーブスロット10番、今後の機能追加時は必ずセーブ関連更新必須

### 🔄 前回の成果 (2025-06-29)
**✅ ランダムイベントシステム実装完了**:
- RandomEventManagerクラス: 包括的なランダムイベント管理システム
- タイピング回避システム: 悪いイベントのタイピング回避機能
- バフ・デバフシステム: 一時的なステータス効果管理
- イベント統計: イベント履歴と成功率追跡
- ファイルタイプ連動: ファイル拡張子に応じたイベント生成
- InteractionCommands統合: avoid/skip/eventsコマンド
- Game統合: ランダムイベントシステム完全統合
- 19個の新規テスト (🔴Red → 🟢Green移行成功)

### 🔄 前回の成果 (2025-06-28)
**✅ 戦闘システム実装完了**:
- TypingChallengeクラス: プログラミング用語タイピングシステム
- BattleCommandsクラス: ターン制戦闘・ダメージ計算
- 5段階難易度: 基本→中級→上級→プログラミング→専門用語
- WPM計算・精度評価・完璧ボーナス・最小ダメージ保証
- CommandProcessor統合: battle/attack/fleeコマンド
- Game統合: マップ・ワールド・戦闘システム完全統合
- 21個の新規テスト (🔴Red → 🟢Green移行成功)

### 🔧 品質チェック
実装変更後は必ず以下を実行：
```bash
npm run check  # 全品質チェック (Lint + Format + Test)
```

## claudeへの指示
### 作業ログ
タスクが完了する毎にCLAUDE.mdおよびその参照ファイルを更新してください。

### コミュニケーション
コミュニケーションは日本語で行ってください。

### 現在時刻
現在の時刻は`date`コマンドで取得してください。

### Git
きりの良いfeature毎に`git commit`してください。

